# 跑团视频自动生成

### 使用说明

#### 下载源码

`git clone git@github.com:amihia/auto_video.git`	

#### 配置文件

本脚本采用根目录下的`setting.json`作为唯一配置文件，具体可看以下的示例。

*注意：`setting.json`的文件中不能有注释，示例中的注释只为方便理解。*

```json
{
    //百度语音朗读的API_ID,API_KEY,SECRET_KEY
    //如何申请请看：https://jingyan.baidu.com/article/ab0b563063a586c15bfa7d55.html
    "APP_ID": "",
    "API_KEY": "",
    "SECRET_KEY": "",
    //角色语音、位置设置
    "character": {
        "kp": {
            //语速、发音人、音调
            "sound": {
                "spd": 6,
                "per": 2,
                "pit": 4
            }
        },
        "pc": {
            "sound": {
                "spd": 6,
                "per": 1,
                "pit": 4
            }
        }
    },
    //文本颜色
    "color": {
        "R": 255,
        "G": 255,
        "B": 255
    },
    //每行的文本长度
    "_len": 23,
    //文本位置，如果设置为0则自适应
    "position": 37,
    //对话框样式，可选1~3
    "dhk_num": 1
}
```

#### 剧本文件

本脚本默认采用根目录下的`text.txt`作为剧本文件，当然你也可以使用GUI来自由选择剧本。剧本文件的格式可参照如下示例。

*注意：`text.txt`的编码格式为UTF-8，而且开头和结尾不能有额外的空行。*

```
pc
我要跳车

kp(愉悦)
sma二话不说 直接从车上跳了下去，他踩到了路边的狗屎，滚进了泰晤士河。冰凉的河水盖过了他的剧痛，让人仍然保有一丝清醒
```

剧本文件以每两行为一个识别单位，中间的空行作为分隔，第一行为角色名，第二行为文本。角色名后加括号可使用不同状态的立绘。

*注意：如果角色名为bg，那么文本将会被识别为背景文件的名称，不被计入帧数当中。*

如果剧本文件中的角色没有在配置文件中，则会使用百度语音合成默认的配置。

#### 图像文件

图像文件统一放置于`img`文件夹内，角色立绘的文件名即为角色名，默认对话框的文件名需为`dhk1`，默认背景的文件名需为`bg`。

### 旧版使用说明（建议编程小白阅读）

初次使用请使用文件夹内的python-3.6.7-amd64.exe，并在安装过程中勾选其中的add python 3.6 to path

安装完成之后点击文件夹下的init.bat并等待其运行完成



合成视频前，先将记录跑团信息的text.txt文件放入根目录

修改该文件夹下的setting.json文件，以改变人物声音信息

每行置一个人物信息，格式为：人名 语速 声源 语调。语速和声调范围为1-9，声源为0-4

若没有设置，则使用默认的6 1 7



将人物立绘置于img文件夹中，并修改名称为：人物姓名.png，否则将使用img/default文件夹中的pc.png

背景图片置于img文件夹下，并修改名称为：bg.jpg，否则将使用zc文件夹中的bg.jpg

position.txt文件可以调整字在视频中的位置，范围为0-60，推荐且默认为36

len.txt文件可以调整每一行字的数量，推荐推荐且默认为23

color.txt文件可以修改字的颜色，为rgb颜色，即三个数字用空格分隔开来。推荐且默认为白色。最典型的，黑色是0 0 0，白色是255 255 255



对于python程序，你需要自己在百度ai里申请语音合成服务，并在代码开头填上你的 api_id、api_key、secret_key，具体方法见https://jingyan.baidu.com/article/ab0b563063a586c15bfa7d55.html



值得一提的是，最终的生成结果是video文件夹里的zc0——zcn的avi文件序列。关于为什么不直接生成完整mp4文件，最主要的原因是这里使用的

ffmepg实在在拼接这块太慢了，所以生成avi文件序列，让大家自行使用格式工厂进行一秒拼接（笑）

### TO DO List

- [x] 语音编辑GUI
- [x] 立绘左右位置
- [x] 颜色选取
- [x] 同角色不同立绘
- [x] 同剧本多张背景图片
- [x] 自由选取剧本文件
- [ ] 解决音画不同步bug
- [ ] 解决重载配置后UI错位bug